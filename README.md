# hng13-stage1
⚙️ DevOps Intern Stage 1 Task: Automated Deployment Bash ScriptProject OverviewThis repository contains deploy.sh, a robust, production-grade Bash script designed to fully automate the setup, deployment, and configuration of a Dockerized application onto a remote Linux server.This script streamlines the Continuous Deployment (CD) process by handling everything from Git authentication and cloning to setting up a reverse proxy with Nginx. It is built with a focus on error handling, logging, and idempotency, ensuring reliable and repeatable deployments.FeaturesThe deploy.sh script is a single, self-contained executable that manages the entire deployment lifecycle in a sequential, reliable manner:1. User Input & ValidationCollects and validates essential deployment parameters:Git Repository URLPersonal Access Token (PAT) for authentication.Branch Name (defaults to main).Remote Server SSH details (Username, IP, and Key Path).Application Port (internal container port).2. Local Repository ManagementAuthenticates and clones the specified Git repository.Handles existing repositories by performing a git pull to fetch the latest changes.Switches to the specified target branch.Verifies the presence of a Dockerfile or docker-compose.yml before proceeding.3. Remote Server SetupEstablishes a secure SSH connection and performs necessary connectivity checks.Remotely prepares the environment:Updates system packages (apt update).Installs Docker, Docker Compose, and Nginx (with idempotency checks).Configures user permissions for Docker.Confirms service status and version numbers.4. Application DeploymentSecurely transfers the project files to the remote host (e.g., using scp or rsync).Builds the Docker image and runs the application using either docker build/docker run or docker-compose up -d.Includes validation checks for container health and successful startup.5. Nginx Reverse Proxy ConfigurationDynamically generates or overwrites the Nginx configuration file.Configures Nginx to forward incoming HTTP traffic (port 80) to the container's internal application port.Includes a placeholder or basic configuration for SSL readiness.Tests the new Nginx configuration and reloads the service.6. Reliability and ValidationComprehensive Logging: All actions (success and failure) are logged to a timestamped file (deploy_YYYYMMDD.log).Error Handling: Implements trap functions for graceful exit on unexpected errors and utilizes meaningful exit codes for each stage.Deployment Validation: Confirms that Docker, Nginx, and the target application container are all running and accessible using local and remote curl tests.7. Idempotency and CleanupThe script is fully idempotent, meaning it can be safely re-run without disrupting or duplicating existing infrastructure.Gracefully stops and removes old containers before redeploying.Optional Cleanup: Supports a dedicated --cleanup flag to remove all deployed resources (containers, networks, and Nginx config) from the remote server.PrerequisitesTo use this script, you must have the following prepared:Local Machine:A Linux/macOS environment with Bash and standard utilities (git, ssh, scp).chmod +x deploy.sh permission granted on the script.Git Repository:A GitHub repository containing a Dockerfile or docker-compose.yml.A Personal Access Token (PAT) with repo scope.Remote Linux Server (Target):An accessible Linux server (e.g., Ubuntu/Debian, CentOS/RHEL).A user account with sudo privileges.An SSH Private Key securely stored on the local machine for key-based authentication.UsageStep 1: Grant Execution PermissionEnsure the script is executable:chmod +x deploy.sh
Step 2: Run the DeploymentExecute the script and follow the prompts for input:./deploy.sh
The script will guide you through entering the following required parameters:ParameterExampleNotesGit Repository URLhttps://github.com/user/project.gitFull HTTPS URL.Personal Access Token (PAT)ghp_xxxxxxxxxxxxxxxxxxxxxxRequires repo scope.Branch NamedevelopmentOptional. Defaults to main if left empty.SSH UsernameubuntuUser on the remote server.Remote IP Address192.168.1.100Public or Private IP of the target server.SSH Key Path~/.ssh/id_rsaAbsolute or relative path to the private key.Application Port8080The internal port the Docker container exposes.Optional Cleanup ModeTo gracefully remove all resources deployed by the script (Docker container, Nginx config, transferred files), run it with the --cleanup flag:./deploy.sh --cleanup
Logging and DebuggingAll deployment activity is recorded in a log file in the execution directory.Log File Format: deploy_YYYYMMDD.logThe log includes timestamps, the execution stage, and the status (SUCCESS/FAILURE) of each command.If the script fails, check the log file for the specific error message and the exit code to determine the failed stage.Submission NotesThis script is POSIX-compliant for broad compatibility across various Linux distributions.No external configuration management tools (Ansible, Terraform) were used, adhering strictly to the pure Bash script requirement.
